<!-- TODO: desc -->

{% extends "base.html" %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/gallery.css') }}">
{% endblock %}

{% block content %}
    <div id="sidebar">
        <div class="profile-picture">
            <img src="{{ url_for('static', filename='imgs/profiles/' +  artist.id|string  + '.jpg' ) }}">
        </div>
        <h2>{{ artist.display_name }}</h2>
        <h4>{{ artist.artist_title }}</h4>
        <p>{{ artist.artist_description }}</p>
        {% if artist.id == current_user.id %}
            <a href="/upload_image">Upload Image</a>
            <a href="/add_offer">Add Offer</a>
            <a href="/edit_details">Edit Details</a>
        {% endif %}
    </div>

    <div class="gallery-container">
        <h2>Offers</h2>
            <div class="carousel-container">
                {% for offer in offers %}
                    <div class="slide" onclick="openOfferModal('{{ offer.id }}')">
                        <img src="{{ url_for('static', filename=offer.image_path) }}" alt="{{ offer.title }}">
                    </div>
                {% endfor %}
            </div>
        <!-- JavaScript to manage the carousel navigation -->
        <script>
        const carouselContainer = document.querySelector(".carousel-container");
        const slides = [...document.querySelectorAll(".slide")];
        let currentSlideIndex = 0;

        function nextSlide() {
            currentSlideIndex = (currentSlideIndex + 1) % slides.length; // Move to the next slide
            const translateValue = `translateX(-${currentSlideIndex * 100}%)`;
            slides.forEach(slide => slide.style.transform = translateValue);
        }

        function prevSlide() {
            currentSlideIndex = currentSlideIndex > 0 ? currentSlideIndex - 1 : slides.length - 1; // Move to the previous slide
            const translateValue = `translateX(-${currentSlideIndex * 100}%)`;
            slides.forEach(slide => slide.style.transform = translateValue);
        }
        </script>
        <!-- Add the arrow buttons for navigation -->
        <button id="left-arrow" onclick="prevSlide();"><</button>
        <button id="right-arrow" onclick="nextSlide();">></button>

        <h2>Art Gallery</h2>
        <div class="gallery" id="imagesGallery">
            {% for image in images %}
            <div class="image-container">
                <img id="{{ image.id }}" src="{{ url_for('static', filename=image.image_path) }}" class="img-fluid" alt="{{ image.title }}">
            </div>
            {% endfor %}
        </div>
    </div>

    <div id="imageModal">
        <div class="modal-content">
            <img id="enlargedImage" src="" alt="Enlarged Image">
            <div class="image-description">
                <h3 id="imageTitle">Image Title</h3>
                <p id="imageDesc">Image description goes here...</p>
            </div>
        </div>
    </div>

    <div class="modal fade" id="offerModal" tabindex="-1" aria-labelledby="offerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="offerModalLabel">Offer Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            <img id="modalImage" src="" alt="" class="img-fluid">
                        </div>
                        <div class="col-md-6">
                            <h4 id="modalTitle"></h4>
                            <p id="modalDescription"></p>
                            <!-- Contact form here -->
                            <form>
                                <!-- Form fields -->
                                <button type="submit" class="btn btn-primary">Contact</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

        <script>
        document.addEventListener('DOMContentLoaded', function () {
            const galleryImages = document.querySelectorAll('.gallery img');
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('enlargedImage');
            const modalTitle = document.getElementById('imageTitle');
            const modalDesc = document.getElementById('imageDesc');

            galleryImages.forEach(img => {
                img.addEventListener('click', function () {
                    modal.style.display = 'block';
                    modalImage.src = this.src;
                    modalTitle.textContent = this.alt;
                    modalDesc.textContent = 'Description for ' + this.alt;
                });
            });

            modal.addEventListener('click', function () {
                modal.style.display = 'none';
            });

            modal.style.display = 'none';
        });

        function openOfferModal(offerId) {
            const offer = {{ offers|tojson }};
            const selectedOffer = offer.find(o => o.id == offerId);

            document.getElementById('modalImage').src = `/static/${selectedOffer.image_path}`;
            document.getElementById('modalTitle').textContent = selectedOffer.title;
            document.getElementById('modalDescription').textContent = selectedOffer.description;

            var myModal = new bootstrap.Modal(document.getElementById('offerModal'), {
            keyboard: false
        });
    myModal.show();
}
        </script>
{% endblock %}

